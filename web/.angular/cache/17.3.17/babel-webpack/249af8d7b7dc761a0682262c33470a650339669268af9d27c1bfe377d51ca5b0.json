{"ast":null,"code":"import _asyncToGenerator from \"/Users/briangormanly/projects/mipo/mipo-vibes/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { DecimalPipe, NgClass, NgFor, NgIf } from '@angular/common';\nimport { computed, inject, signal } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { HttpClient } from '@angular/common/http';\nimport { WeightingService } from './services/weighting.service';\nimport * as i0 from \"@angular/core\";\nconst _c0 = a0 => ({\n  capped: a0\n});\nfunction AppComponent_div_0_label_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"label\", 23)(1, \"input\", 24);\n    i0.ɵɵlistener(\"change\", function AppComponent_div_0_label_11_Template_input_change_1_listener($event) {\n      const variable_r3 = i0.ɵɵrestoreView(_r2).$implicit;\n      const ctx_r3 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r3.toggleVariable(variable_r3.key, $event.target.checked));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"span\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const variable_r3 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵclassProp(\"party\", variable_r3.key === \"PARTY\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"checked\", ctx_r3.selectedVariables().has(variable_r3.key))(\"disabled\", variable_r3.key === \"PARTY\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(variable_r3.label);\n  }\n}\nfunction AppComponent_div_0_label_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"label\", 12)(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"input\", 25);\n    i0.ɵɵlistener(\"input\", function AppComponent_div_0_label_15_Template_input_input_3_listener($event) {\n      const variable_r6 = i0.ɵɵrestoreView(_r5).$implicit;\n      const ctx_r3 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r3.updateRefusal(variable_r6.key, $event));\n    });\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    let tmp_6_0;\n    const variable_r6 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(variable_r6.label);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"value\", (tmp_6_0 = ctx_r3.refusalRates()[variable_r6.key]) !== null && tmp_6_0 !== undefined ? tmp_6_0 : 0);\n  }\n}\nfunction AppComponent_div_0_label_30_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"label\", 12)(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"input\", 26);\n    i0.ɵɵlistener(\"input\", function AppComponent_div_0_label_30_Template_input_input_3_listener($event) {\n      const category_r8 = i0.ɵɵrestoreView(_r7).$implicit;\n      const ctx_r3 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r3.updatePartyTarget(category_r8.key, $event));\n    });\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const category_r8 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(category_r8.label);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"value\", ctx_r3.partyTargets()[category_r8.key]);\n  }\n}\nfunction AppComponent_div_0_div_36_tr_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\")(7, \"input\", 29);\n    i0.ɵɵlistener(\"input\", function AppComponent_div_0_div_36_tr_13_Template_input_input_7_listener($event) {\n      const category_r10 = i0.ɵɵrestoreView(_r9).$implicit;\n      const variable_r11 = i0.ɵɵnextContext().$implicit;\n      const ctx_r3 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r3.updateCount(variable_r11.key, category_r10.key, $event));\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    let tmp_9_0;\n    const category_r10 = ctx.$implicit;\n    const variable_r11 = i0.ɵɵnextContext().$implicit;\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(category_r10.label);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(5, 3, category_r10.share, \"1.2-2\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"value\", (tmp_9_0 = (tmp_9_0 = ctx_r3.counts()[variable_r11.key]) == null ? null : tmp_9_0[category_r10.key]) !== null && tmp_9_0 !== undefined ? tmp_9_0 : 0);\n  }\n}\nfunction AppComponent_div_0_div_36_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 27)(1, \"h3\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"table\")(4, \"thead\")(5, \"tr\")(6, \"th\");\n    i0.ɵɵtext(7, \"Category\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Target Share\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Sample Count\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(12, \"tbody\");\n    i0.ɵɵtemplate(13, AppComponent_div_0_div_36_tr_13_Template, 8, 6, \"tr\", 28);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const variable_r11 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(variable_r11.label);\n    i0.ɵɵadvance(11);\n    i0.ɵɵproperty(\"ngForOf\", variable_r11.categories);\n  }\n}\nfunction AppComponent_div_0_p_42_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 30);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r3.errorMessage());\n  }\n}\nfunction AppComponent_div_0_div_46_tr_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\", 35)(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\");\n    i0.ɵɵtext(9);\n    i0.ɵɵpipe(10, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵtext(12);\n    i0.ɵɵpipe(13, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"td\");\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const row_r13 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(16, _c0, row_r13.capped));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r13.variable);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r13.category);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(7, 7, row_r13.target, \"1.2-2\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(10, 10, row_r13.sampleShare, \"1.2-2\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(13, 13, row_r13.weight, \"1.2-2\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(row_r13.capped ? \"Yes\" : \"No\");\n  }\n}\nfunction AppComponent_div_0_div_46_div_25_li_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵpipe(3, \"number\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const cap_r14 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate4(\" \", cap_r14.variable, \" \\u2192 \", cap_r14.category, \": suggested \", i0.ɵɵpipeBind2(2, 4, cap_r14.suggestedWeight, \"1.2-2\"), \", capped to \", i0.ɵɵpipeBind2(3, 7, cap_r14.cappedTo, \"1.2-2\"), \" \");\n  }\n}\nfunction AppComponent_div_0_div_46_div_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"h4\");\n    i0.ɵɵtext(2, \"Cap Hits\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ul\");\n    i0.ɵɵtemplate(4, AppComponent_div_0_div_46_div_25_li_4_Template, 4, 10, \"li\", 28);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const result_r15 = i0.ɵɵnextContext().ngIf;\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", result_r15.diagnostics.capHits);\n  }\n}\nfunction AppComponent_div_0_div_46_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"table\")(2, \"thead\")(3, \"tr\")(4, \"th\");\n    i0.ɵɵtext(5, \"Variable\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Category\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Target\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Sample Share\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"th\");\n    i0.ɵɵtext(13, \"Weight\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"th\");\n    i0.ɵɵtext(15, \"Cap Hit?\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(16, \"tbody\");\n    i0.ɵɵtemplate(17, AppComponent_div_0_div_46_tr_17_Template, 16, 18, \"tr\", 31);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(18, \"div\", 32)(19, \"h3\");\n    i0.ɵɵtext(20, \"Diagnostics\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"p\");\n    i0.ɵɵtext(22);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"p\");\n    i0.ɵɵtext(24);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(25, AppComponent_div_0_div_46_div_25_Template, 5, 1, \"div\", 33);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"button\", 34);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_0_div_46_Template_button_click_26_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r3 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r3.exportCategoryCsv());\n    });\n    i0.ɵɵtext(27, \"Export Category Weights CSV\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const result_r15 = ctx.ngIf;\n    i0.ɵɵadvance(17);\n    i0.ɵɵproperty(\"ngForOf\", result_r15.categoryTable);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"Iterations: \", result_r15.diagnostics.iterations, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Converged: \", result_r15.diagnostics.converged ? \"Yes\" : \"No\", \"\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", result_r15.diagnostics.capHits.length > 0);\n  }\n}\nfunction AppComponent_div_0_ng_template_47_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 15);\n    i0.ɵɵtext(1, \"Compute weights to see results and diagnostics.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 3)(1, \"header\", 4)(2, \"h1\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\", 5);\n    i0.ɵɵtext(5, \"Demographic raking first, party post-stratification second.\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 6)(7, \"section\", 7)(8, \"h2\");\n    i0.ɵɵtext(9, \"Variables\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"div\", 8);\n    i0.ɵɵtemplate(11, AppComponent_div_0_label_11_Template, 4, 5, \"label\", 9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"h2\");\n    i0.ɵɵtext(13, \"Refusal % (per variable)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"div\", 8);\n    i0.ɵɵtemplate(15, AppComponent_div_0_label_15_Template, 4, 2, \"label\", 10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"h2\");\n    i0.ɵɵtext(17, \"Caps\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"div\", 11)(19, \"label\", 12)(20, \"span\");\n    i0.ɵɵtext(21, \"Min\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"input\", 13);\n    i0.ɵɵlistener(\"input\", function AppComponent_div_0_Template_input_input_22_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.updateCaps(\"min\", $event));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(23, \"label\", 12)(24, \"span\");\n    i0.ɵɵtext(25, \"Max\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"input\", 13);\n    i0.ɵɵlistener(\"input\", function AppComponent_div_0_Template_input_input_26_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.updateCaps(\"max\", $event));\n    });\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(27, \"h2\");\n    i0.ɵɵtext(28, \"Party Targets\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"div\", 8);\n    i0.ɵɵtemplate(30, AppComponent_div_0_label_30_Template, 4, 2, \"label\", 10);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(31, \"section\", 14)(32, \"h2\");\n    i0.ɵɵtext(33, \"Category Counts\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(34, \"p\", 15);\n    i0.ɵɵtext(35, \"Paste sample counts per category. Totals auto-normalize to shares.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(36, AppComponent_div_0_div_36_Template, 14, 2, \"div\", 16);\n    i0.ɵɵelementStart(37, \"div\", 17)(38, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_0_Template_button_click_38_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.resetCounts());\n    });\n    i0.ɵɵtext(39, \"Reset Counts\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(40, \"button\", 19);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_0_Template_button_click_40_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.compute());\n    });\n    i0.ɵɵtext(41);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(42, AppComponent_div_0_p_42_Template, 2, 1, \"p\", 20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(43, \"section\", 21)(44, \"h2\");\n    i0.ɵɵtext(45, \"Results\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(46, AppComponent_div_0_div_46_Template, 28, 4, \"div\", 22)(47, AppComponent_div_0_ng_template_47_Template, 2, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const target_r16 = ctx.ngIf;\n    const emptyState_r17 = i0.ɵɵreference(48);\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r3.title);\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"ngForOf\", target_r16.variables);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", target_r16.variables);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"value\", ctx_r3.caps().min);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"value\", ctx_r3.caps().max);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.partyCategories());\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngForOf\", target_r16.variables);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"disabled\", ctx_r3.isComputing());\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r3.isComputing() ? \"Computing\\u2026\" : \"Compute\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.errorMessage());\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.computeResult())(\"ngIfElse\", emptyState_r17);\n  }\n}\nfunction AppComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 36)(1, \"p\");\n    i0.ɵɵtext(2, \"Loading ACS targets\\u2026\");\n    i0.ɵɵelementEnd()();\n  }\n}\nexport let AppComponent = /*#__PURE__*/(() => {\n  class AppComponent {\n    constructor() {\n      this.http = inject(HttpClient);\n      this.weightingService = inject(WeightingService);\n      this.title = 'MIPO Weighting Calculator';\n      this.targetSet = signal(null);\n      this.selectedVariables = signal(new Set(['RACE', 'GENDER', 'AGE', 'INCOME', 'REGION']));\n      this.refusalRates = signal({\n        INCOME: 0.13\n      });\n      this.partyTargets = signal({\n        DEM: 0.33,\n        REP: 0.3,\n        IND_OTHER: 0.37\n      });\n      this.caps = signal({\n        min: 0.5,\n        max: 2.0\n      });\n      this.counts = signal({});\n      this.computeResult = signal(null);\n      this.isComputing = signal(false);\n      this.errorMessage = signal(null);\n      this.categoriesTable = computed(() => this.computeResult()?.categoryTable ?? []);\n      this.partyCategories = computed(() => {\n        const target = this.targetSet();\n        if (!target) {\n          return [];\n        }\n        const partyVariable = target.variables.find(variable => variable.key === 'PARTY');\n        return partyVariable?.categories ?? [];\n      });\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const target = yield _this.http.get('assets/targets/acs_all_adults_national.json').toPromise();\n        if (target) {\n          _this.targetSet.set(target);\n          _this.initializeCounts(target.variables);\n          const partyVariable = target.variables.find(variable => variable.key === 'PARTY');\n          if (partyVariable) {\n            const defaultPartyTargets = {};\n            for (const category of partyVariable.categories) {\n              defaultPartyTargets[category.key] = category.share;\n            }\n            _this.partyTargets.set(defaultPartyTargets);\n          }\n        }\n      })();\n    }\n    toggleVariable(variableKey, checked) {\n      const next = new Set(this.selectedVariables().values());\n      if (checked) {\n        next.add(variableKey);\n      } else {\n        next.delete(variableKey);\n      }\n      this.selectedVariables.set(next);\n    }\n    updateRefusal(variableKey, event) {\n      const value = Number(event.target.value);\n      const next = {\n        ...this.refusalRates()\n      };\n      if (Number.isNaN(value)) {\n        delete next[variableKey];\n      } else {\n        next[variableKey] = Math.min(Math.max(value, 0), 0.9);\n      }\n      this.refusalRates.set(next);\n    }\n    updatePartyTarget(categoryKey, event) {\n      const value = Number(event.target.value);\n      const next = {\n        ...this.partyTargets()\n      };\n      if (!Number.isNaN(value)) {\n        next[categoryKey] = value;\n      }\n      this.partyTargets.set(next);\n    }\n    updateCaps(key, event) {\n      const value = Number(event.target.value);\n      const next = {\n        ...this.caps()\n      };\n      if (!Number.isNaN(value)) {\n        next[key] = value;\n      }\n      this.caps.set(next);\n    }\n    updateCount(variableKey, categoryKey, event) {\n      const rawValue = event.target.value;\n      const value = Number(rawValue);\n      const next = this.cloneCounts();\n      if (!next[variableKey]) {\n        next[variableKey] = {};\n      }\n      next[variableKey][categoryKey] = Number.isNaN(value) ? 0 : Math.max(value, 0);\n      this.counts.set(next);\n    }\n    resetCounts() {\n      const target = this.targetSet();\n      if (!target) {\n        return;\n      }\n      this.initializeCounts(target.variables);\n      this.computeResult.set(null);\n    }\n    compute() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const target = _this2.targetSet();\n        if (!target) {\n          return;\n        }\n        _this2.isComputing.set(true);\n        _this2.errorMessage.set(null);\n        try {\n          const counts = _this2.extractCounts();\n          const result = _this2.weightingService.compute({\n            targetSet: target,\n            variables: Array.from(_this2.selectedVariables()),\n            partyVariable: 'PARTY',\n            partyTargets: _this2.partyTargets(),\n            refusals: _this2.refusalRates(),\n            caps: _this2.caps(),\n            counts\n          });\n          _this2.computeResult.set(result);\n        } catch (error) {\n          console.error(error);\n          _this2.errorMessage.set(error.message ?? 'Unable to compute weights');\n        } finally {\n          _this2.isComputing.set(false);\n        }\n      })();\n    }\n    exportCategoryCsv() {\n      const result = this.computeResult();\n      if (!result) {\n        return;\n      }\n      const header = 'Variable,Category,Target,Sample Share,Weight,Capped\\n';\n      const rows = result.categoryTable.map(row => `${row.variable},${row.category},${row.target.toFixed(4)},${row.sampleShare.toFixed(4)},${row.weight.toFixed(4)},${row.capped}`).join('\\n');\n      const csv = `${header}${rows}`;\n      const blob = new Blob([csv], {\n        type: 'text/csv'\n      });\n      const url = URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = 'category-weights.csv';\n      link.click();\n      URL.revokeObjectURL(url);\n    }\n    initializeCounts(variables) {\n      const next = {};\n      for (const variable of variables) {\n        next[variable.key] = {};\n        for (const category of variable.categories) {\n          next[variable.key][category.key] = 0;\n        }\n      }\n      this.counts.set(next);\n    }\n    extractCounts() {\n      const counts = [];\n      for (const [variable, categories] of Object.entries(this.counts())) {\n        for (const [category, value] of Object.entries(categories)) {\n          counts.push({\n            variable,\n            category,\n            n: value ?? 0\n          });\n        }\n      }\n      return counts;\n    }\n    cloneCounts() {\n      const snapshot = this.counts();\n      const clone = {};\n      for (const [variable, categories] of Object.entries(snapshot)) {\n        clone[variable] = {\n          ...categories\n        };\n      }\n      return clone;\n    }\n    static {\n      this.ɵfac = function AppComponent_Factory(t) {\n        return new (t || AppComponent)();\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: AppComponent,\n        selectors: [[\"app-root\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 2,\n        vars: 2,\n        consts: [[\"emptyState\", \"\"], [\"class\", \"page\", 4, \"ngIf\"], [\"class\", \"loading\", 4, \"ngIf\"], [1, \"page\"], [1, \"header\"], [1, \"subtitle\"], [1, \"layout\"], [1, \"panel\", \"inputs\"], [1, \"stack\"], [\"class\", \"toggle\", 3, \"party\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"field\", 4, \"ngFor\", \"ngForOf\"], [1, \"caps\"], [1, \"field\"], [\"type\", \"number\", \"step\", \"0.1\", \"min\", \"0\", 3, \"input\", \"value\"], [1, \"panel\", \"counts\"], [1, \"hint\"], [\"class\", \"counts-group\", 4, \"ngFor\", \"ngForOf\"], [1, \"actions\"], [\"type\", \"button\", 1, \"secondary\", 3, \"click\"], [\"type\", \"button\", 3, \"click\", \"disabled\"], [\"class\", \"error\", 4, \"ngIf\"], [1, \"panel\", \"results\"], [4, \"ngIf\", \"ngIfElse\"], [1, \"toggle\"], [\"type\", \"checkbox\", 3, \"change\", \"checked\", \"disabled\"], [\"type\", \"number\", \"step\", \"0.01\", \"min\", \"0\", \"max\", \"0.9\", 3, \"input\", \"value\"], [\"type\", \"number\", \"step\", \"0.01\", \"min\", \"0\", \"max\", \"1\", 3, \"input\", \"value\"], [1, \"counts-group\"], [4, \"ngFor\", \"ngForOf\"], [\"type\", \"number\", \"min\", \"0\", 3, \"input\", \"value\"], [1, \"error\"], [3, \"ngClass\", 4, \"ngFor\", \"ngForOf\"], [1, \"diagnostics\"], [4, \"ngIf\"], [\"type\", \"button\", 3, \"click\"], [3, \"ngClass\"], [1, \"loading\"]],\n        template: function AppComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵtemplate(0, AppComponent_div_0_Template, 49, 12, \"div\", 1)(1, AppComponent_div_1_Template, 3, 0, \"div\", 2);\n          }\n          if (rf & 2) {\n            i0.ɵɵproperty(\"ngIf\", ctx.targetSet());\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.targetSet());\n          }\n        },\n        dependencies: [NgIf, NgFor, FormsModule, DecimalPipe, NgClass],\n        styles: [\".page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;padding:1.5rem 2rem 2rem}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.75rem}.subtitle[_ngcontent-%COMP%]{margin:.25rem 0 0;color:#52606d}.layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:260px 1fr 380px;gap:1.5rem}.panel[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 12px 24px #0f172a14;padding:1.25rem;display:flex;flex-direction:column;gap:1rem}.panel[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;color:#1f2933}.stack[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.toggle[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem .75rem;border:1px solid #d9e2ec;border-radius:8px;background:#f8fafc}.toggle.party[_ngcontent-%COMP%]{opacity:.6}.field[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:.75rem;padding:.5rem .75rem;border:1px solid #e4ebf5;border-radius:8px;background:#fff}.field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:80px;padding:.25rem .4rem;border-radius:6px;border:1px solid #cbd2d9}.caps[_ngcontent-%COMP%]{display:flex;gap:.75rem}.counts-group[_ngcontent-%COMP%]{border:1px solid #dfe3eb;border-radius:10px;padding:.75rem;background:#fbfdff}.counts-group[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1rem;color:#243b53}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.9rem}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{text-align:left;padding:.5rem;border-bottom:1px solid #e4ebf5}td[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:100%;box-sizing:border-box;padding:.35rem .5rem;border-radius:6px;border:1px solid #cbd2d9}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem}button[_ngcontent-%COMP%]{border:none;border-radius:8px;padding:.6rem 1.2rem;background:linear-gradient(135deg,#1e88e5,#2563eb);color:#fff;font-weight:600;transition:transform .1s ease,box-shadow .2s ease}button.secondary[_ngcontent-%COMP%]{background:#e0e8f9;color:#1f2933}button[_ngcontent-%COMP%]:disabled{opacity:.65;cursor:not-allowed}button[_ngcontent-%COMP%]:not(:disabled):hover{transform:translateY(-1px);box-shadow:0 10px 18px #2563eb40}.results[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr.capped[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background:#ef53501a}.diagnostics[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:.5rem 0 0;padding-left:1.25rem}.hint[_ngcontent-%COMP%]{color:#52606d;font-size:.85rem}.error[_ngcontent-%COMP%]{color:#c81e1e;font-weight:500}.loading[_ngcontent-%COMP%]{padding:4rem;text-align:center;color:#52606d}@media (max-width: 1280px){.layout[_ngcontent-%COMP%]{grid-template-columns:1fr}}\"]\n      });\n    }\n  }\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}